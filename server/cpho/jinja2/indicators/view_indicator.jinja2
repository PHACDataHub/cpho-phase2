{% extends 'base.jinja2' %}
{% import 'breadcrumb_macros.jinja2' as bc %}

{% block content_breadcrumbs %}
  {{ bc.indicators_index() }}
  {{ bc.indicator(indicator,True) }}
{% endblock %}


{% block content %}
  <div class="h2">{{ tdt("Indicator Selected: ") }} {{ indicator.name }}</div>
  <div class="mt-4">

    {% if respects_rule('can_edit_indicator', indicator) %}
      <a href="{{ url('edit_indicator', args=[indicator.id]) }}"
         class="btn btn-primary">{{ tdt("Edit indicator") }}</a>
    {% endif %}
    {% if respects_rule('can_view_indicator_data', indicator) %}
      <a href="{{ url('indicator_scoped_changelog', args=[indicator.id]) }}"
         class="btn btn-success">{{ tdt("View changelog for this indicator's data") }}</a>
    {% endif %}
  </div>
  {% if respects_rule('can_view_indicator_data', indicator) %}
    <div class="mt-5">
      <div class="h3">{{ tdt("Periods with data") }}</div>
      <table class="table table-hover">
        <thead>
          <tr>
            <th>{{ tdt("Period") }}</th>
            <th>{{ tdt("Data Count") }}</th>
            <th width="35%">{{ tdt("Progress") }}</th>
            <th class="text-center">{{ tdt("Actions") }}</th>
          </tr>
        </thead>
        <tbody>
          {% for period,data_count in data_counts_by_period.items() %}
            {% if data_count > 0 %}
              {% set submission_statuses = submission_statuses_by_period[period] %}
              {% set progress_in_table = True %}
              <tr href="{{ url('view_indicator_for_period', args=[indicator.id, period.pk]) }}">
                <th>{{ period }}</th>
                <td>{{ data_count }}</td>
                <td>{% include 'indicators/_progress_bar.jinja2' %}</td>
                <td class="text-center">
                  <a class='btn btn-outline-dark'
                     href="{{ url('view_indicator_for_period', args=[indicator.id, period.pk]) }}">{{ tdt("See/Edit data") }}</a>
                </td>
              </tr>
            {% endif %}
          {% endfor %}
        </tbody>
      </table>
    </div>
    <div class="mt-5">
      <div class="h3">{{ tdt("Add data for new periods") }}</div>
      <div>
        <ul>
          {% for period,data_count in data_counts_by_period.items() %}
            {% if data_count == 0 %}
              <li>
                <a href="{{ url('view_indicator_for_period', args=[indicator.id, period.pk]) }}">{{ tdt("Add data for ") }} {{ period }}</a>
              </li>
            {% endif %}
          {% endfor %}
        </ul>
      </div>
    </div>
  {% endif %}

 
{% endblock %}
